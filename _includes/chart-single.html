

{% assign airport = site.data.airports | where: "icao", page.icao | first %}
{% if airport and airport.coordinates and airport.coordinates != "[]" %}
  {% include map-single.html coordinates=airport.coordinates military=false %}
{% endif %}

---

The navigation charts offered on this page are exclusively for flight simulation and cannot and must not be used for real-world aviation.
{: .notice--danger}

---

{% if site.svg_charts and page.svg_charts %}

  <h2>Navigation Charts</h2>


<div style="display: flex;">

  <!-- Viewer for charts -->
  <div id="viewer" style="width: 70%; padding: 10px; position: relative;">
    <div style="position: absolute; top: 10px; right: 10px; z-index: 10;">
    </div>
    <div id="svgScrollContainer" style="width: 100%; height: auto; overflow: auto; border: 1px solid #ccc; background: white; padding-top: 30px;">
      <!-- Floating zoom & popout controls -->
      <div id="viewerControls" style="
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      background: rgba(255,255,255,0.95);
      padding: 5px 8px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      gap: 6px;
    ">
    
<button id="zoomIn" style="padding: 5px 10px; font-size: 12px;">‚ûï</button>
<button id="zoomOut" style="padding: 5px 10px; font-size: 12px;">‚ûñ</button>
<button id="resetZoom" style="padding: 5px 10px; font-size: 12px;">üîÑ</button>
<button id="popoutViewer" style="padding: 5px 10px; font-size: 12px;">‚õ∂</button>
</div>
      <div id="svgContainer" style="transform-origin: top left;"></div>
    </div>
  </div>

  <!-- Sidebar for titles -->
  <div id="sidebar" style="width: 30%; overflow-y: auto; background: #f0f0f0; padding: 10px; border-left: 1px solid #ccc;">
  </div>
</div>


<div id="fullscreenBackdrop" style="
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.6);
  z-index: 9998;
"></div>

<div id="fullscreenViewer" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 80vw;
  height: 80vh;
  background: white;
  z-index: 9999;
  padding: 20px;
  box-sizing: border-box;
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
  border-radius: 8px;
">
  <button id="closeFullscreenBtn" style="
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 8px 10px;
  border-radius: 12px;
  background: white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  border: none;
  font-size: 16px;
  cursor: pointer;
">
  ‚úñ
</button>

  <div id="fullscreenContent" style="width: 100%; height: 100%; overflow: auto; border: 1px solid #ccc;">
  </div>
</div>



<script>

  let activeButton = null;

  const githubUser = "{{ site.svg_charts.github_user }}";
  const githubRepo = "{{ site.svg_charts.github_repo }}";
  const branch = "{{ site.svg_charts.branch }}";
  const icao = "{{ page.svg_charts.icao }}";

  const charts = [
    {% for item in page.svg_charts.files %}
      {
        title: "{{ item.ref }} {{ item.title }}",
        url: `https://raw.githubusercontent.com/${githubUser}/${githubRepo}/refs/heads/${branch}/${icao}/{{ item.file }}`
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ];




const sidebar = document.getElementById('sidebar');
const svgScrollContainer = document.getElementById('svgScrollContainer'); // ‚úÖ Select the scrollable container
const svgContainer = document.getElementById('svgContainer');
const zoomInBtn = document.getElementById('zoomIn');
const zoomOutBtn = document.getElementById('zoomOut');
const resetZoomBtn = document.getElementById('resetZoom');
const popoutBtn = document.getElementById('popoutViewer');
const fullscreen = document.getElementById('fullscreenViewer');
const fullscreenContent = document.getElementById('fullscreenContent');
const viewerControls = document.getElementById('viewerControls');
const backdrop = document.getElementById('fullscreenBackdrop');

let zoomLevel = 1;

let firstButton = null;

charts.forEach((chart, index) => {
  const button = document.createElement('button');
  button.textContent = chart.title;
  button.style.display = "block";
  button.style.width = "100%";
  button.style.marginBottom = "5px";
  button.style.padding = "10px";
  button.style.border = "none";
  button.style.textAlign = "left";
  button.style.cursor = "pointer";
  button.style.background = "#ffffff";
  button.style.borderBottom = "1px solid #ddd";
  button.style.fontSize = "10px";

  button.addEventListener('click', () => {
    loadSVG(chart.url);

    if (activeButton) {
      activeButton.style.backgroundColor = '#ffffff';
      activeButton.style.color = '#000000';
    }
    button.style.backgroundColor = '#007bff';
    button.style.color = '#ffffff';
    activeButton = button;
  });

  sidebar.appendChild(button);

  if (index === 0) {
    firstButton = button;
  }
});

if (firstButton) {
  window.addEventListener('DOMContentLoaded', () => {
    firstButton.click();
  });
}


const zoomLevelDisplay = document.createElement('div');
zoomLevelDisplay.style.position = 'absolute';
zoomLevelDisplay.style.top = '10px';
zoomLevelDisplay.style.left = '10px';
zoomLevelDisplay.style.backgroundColor = 'rgba(255,255,255,0.8)';
zoomLevelDisplay.style.padding = '5px 10px';
zoomLevelDisplay.style.borderRadius = '5px';
zoomLevelDisplay.style.fontSize = '12px';
zoomLevelDisplay.style.fontWeight = 'bold';
zoomLevelDisplay.style.zIndex = '10';
document.getElementById('viewer').appendChild(zoomLevelDisplay);



async function loadSVG(url) {
  svgContainer.innerHTML = "Loading chart...";
  try {
    const response = await fetch(url);
    if (!response.ok) throw new Error("Failed to fetch SVG");
    let reversedBase64 = await response.text();

    reversedBase64 = reversedBase64.trim().replace(/\s+/g, '');

    const base64 = reversedBase64.split('').reverse().join('');

    const svgText = atob(base64);

    svgContainer.innerHTML = svgText;

    const svgElement = svgContainer.querySelector('svg');
    if (svgElement) {
      svgElement.setAttribute('width', '100%');
      svgElement.setAttribute('height', 'auto');
      svgElement.setAttribute('preserveAspectRatio', 'xMidYMid meet');
    }

    zoomLevel = 1;
    applyZoom();
  } catch (err) {
    svgContainer.innerHTML = "<div style='padding:20px; color:red;'>‚ùå Error loading chart. Please try again later.</div>";
    console.error("Error loading SVG:", err);
  }
}

function applyZoom() {
  svgContainer.style.transform = `scale(${zoomLevel})`;
  zoomLevelDisplay.textContent = `${Math.round(zoomLevel * 100)}%`;

  svgScrollContainer.style.overflow = 'hidden';
  setTimeout(() => {
    svgScrollContainer.style.overflow = 'auto';
  }, 10);
}



zoomInBtn.addEventListener('click', () => {
  zoomLevel += 0.2;
  applyZoom();
});

zoomOutBtn.addEventListener('click', () => {
  zoomLevel = Math.max(0.2, zoomLevel - 0.2);
  applyZoom();
});

resetZoomBtn.addEventListener('click', () => {
  zoomLevel = 1;
  applyZoom();
  svgScrollContainer.scrollLeft = 0; 
  svgScrollContainer.scrollTop = 0;  

  svgScrollContainer.style.overflow = 'hidden';
setTimeout(() => {
  svgScrollContainer.style.overflow = 'auto';
}, 50);
});

svgScrollContainer.addEventListener('dblclick', (e) => {
  zoomLevel += 0.5; 
  applyZoom();
});


if (charts.length > 0) {
  loadSVG(charts[0].url);
}

let isDragging = false;
let startX, startY, scrollLeft, scrollTop;

svgScrollContainer.addEventListener('mousedown', (e) => {
  isDragging = true;
  startX = e.pageX - svgScrollContainer.offsetLeft;
  startY = e.pageY - svgScrollContainer.offsetTop;
  scrollLeft = svgScrollContainer.scrollLeft;
  scrollTop = svgScrollContainer.scrollTop;
  svgScrollContainer.style.cursor = "grabbing"; // Change cursor
});

svgScrollContainer.addEventListener('mouseleave', () => {
  isDragging = false;
  svgScrollContainer.style.cursor = "default";
});

svgScrollContainer.addEventListener('mouseup', () => {
  isDragging = false;
  svgScrollContainer.style.cursor = "default";
});

svgScrollContainer.addEventListener('wheel', (e) => {
  if (e.ctrlKey) { // Only if Ctrl is pressed
    e.preventDefault(); // Stop the browser zoom
    if (e.deltaY < 0) {
      zoomLevel += 0.1; // Zoom In
    } else {
      zoomLevel = Math.max(0.2, zoomLevel - 0.1); // Zoom Out
    }
    applyZoom();
  }
}, { passive: false });


svgScrollContainer.addEventListener('mousemove', (e) => {
  if (!isDragging) return;
  e.preventDefault();
  const x = e.pageX - svgScrollContainer.offsetLeft;
  const y = e.pageY - svgScrollContainer.offsetTop;
  const walkX = (x - startX) * 1; // Sensitivity
  const walkY = (y - startY) * 1; // Sensitivity
  svgScrollContainer.scrollLeft = scrollLeft - walkX;
  svgScrollContainer.scrollTop = scrollTop - walkY;
});

let lastTouchDistance = null;

svgScrollContainer.addEventListener('touchmove', (e) => {
  if (e.touches.length === 2) { // 2 fingers
    e.preventDefault(); // Prevent scrolling page
    const touch1 = e.touches[0];
    const touch2 = e.touches[1];
    const currentTouchDistance = Math.hypot(
      touch2.pageX - touch1.pageX,
      touch2.pageY - touch1.pageY
    );

    if (lastTouchDistance) {
      if (currentTouchDistance > lastTouchDistance + 5) {
        zoomLevel += 0.02;
        applyZoom();
      } else if (currentTouchDistance < lastTouchDistance - 5) {
        zoomLevel = Math.max(0.2, zoomLevel - 0.02);
        applyZoom();
      }
    }
    lastTouchDistance = currentTouchDistance;
  }
}, { passive: false });

svgScrollContainer.addEventListener('touchend', () => {
  lastTouchDistance = null;
});



  const closeFullscreenBtn = document.getElementById('closeFullscreenBtn');
  const originalViewerContainer = document.getElementById('viewer');

  popoutBtn.addEventListener('click', () => {
  fullscreenContent.appendChild(svgScrollContainer);
  fullscreen.style.display = 'block';
  backdrop.style.display = 'block';
  setTimeout(() => {
  svgScrollContainer.style.overflow = 'hidden';
  setTimeout(() => {
    svgScrollContainer.style.overflow = 'auto';
  }, 10);
}, 50);
popoutBtn.style.display = 'none';
svgScrollContainer.scrollLeft = 0;
svgScrollContainer.scrollTop = 0;

});

closeFullscreenBtn.addEventListener('click', () => {
  originalViewerContainer.appendChild(svgScrollContainer);
  fullscreen.style.display = 'none';
  backdrop.style.display = 'none';
  popoutBtn.style.display = 'inline-block';
});

backdrop.addEventListener('click', () => {
  closeFullscreenBtn.click(); // Reuse the close logic
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && fullscreen.style.display === 'block') {
    closeFullscreenBtn.click();
  }
});



</script>

{% endif %}