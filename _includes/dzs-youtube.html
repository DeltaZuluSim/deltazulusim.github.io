{% comment %}
Usage:
{% include dzs-youtube.html
  id="bRVRPYDjJhY"
  title="Yak-130 Algerian Livery"
  ratio="16:9"
  controls="play-large,play,progress,current-time,mute,volume,fullscreen"
%}
Params:
- id (required): YouTube video ID
- title (optional): a11y title for iframe
- ratio (optional): default "16:9"
- controls (optional): comma-separated Plyr control names
{% endcomment %}

{% assign _id        = include.id %}
{% assign _title     = include.title | default: "YouTube video player" %}
{% assign _ratio     = include.ratio | default: "16:9" %}
{% assign _controls  = include.controls | default: "play-large,play,progress,current-time,mute,volume,fullscreen" %}
{% assign _dom_id    = 'dzs-player-' | append: _id %}

{% include dzs-plyr-assets.html %}

<div class="dzs-video" style="aspect-ratio: {{ _ratio | replace: 'x', ' / ' | replace: ':', ' / ' }}">
  <div class="plyr__video-embed" id="{{ _dom_id }}">
    <iframe
      src="https://www.youtube-nocookie.com/embed/{{ _id }}?playsinline=1&iv_load_policy=3&modestbranding=1&rel=0&fs=1"
      title="{{ _title | escape }}"
      loading="lazy"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; fullscreen"
      allowfullscreen>
    </iframe>
  </div>
</div>

<script>
  (function() {
    function init() {
      if (!window.Plyr) { return setTimeout(init, 50); }
      var el = document.getElementById('{{ _dom_id }}');
      if (!el) return;

      // Create a distinct Plyr instance for this element
      new Plyr('#{{ _dom_id }}', {
        controls: '{{ _controls }}'.split(','),
        tooltips: { controls: true, seek: true },
        clickToPlay: true,
        keyboard: { global: true },
        invertTime: true,
        ratio: '{{ _ratio | replace: 'x', ':' }}',
        youtube: {
          noCookie: true,
          rel: 0,
          modestbranding: 1,
          iv_load_policy: 3,
          playsinline: 1
        }
      });

      // Defensive CSS to keep YT chrome hidden if it peeks through
      var s = document.createElement('style');
      s.textContent = '.ytp-chrome-top, .ytp-chrome-bottom, .ytp-show-cards-title{display:none!important;}';
      document.head.appendChild(s);
    }
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else { init(); }
  })();
</script>